<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake</title>
</head>

<body onkeydown="return getKeyPress(event)">
    <style>
        .cell {
            width: 10px;
            height: 10px;
            border: 1px solid black;
            padding: 0px;
        }

        .container {
            display: flex;
        }

        .snake {
            background-color: black;
        }



        .food {
            background-color: aqua;
        }
    </style>

    <div id="app"></div>



    <script>
        //Model

        var snakeModel = {
            boardSize: 20,
            snakeHead: { x: 10, y: 10, next: undefined },
            food: { x: 10, y: 10 },
            direction: "up",
        }


        //View

        function showView() {
            document.getElementById('app').innerHTML = /*HTML*/ `
            ${board()}
            `
            let snakeHeadElement = document.getElementById("0" + snakeModel.snakeHead.x.toString() + "0" + snakeModel.snakeHead.y.toString())
            let foodElement = document.getElementById("0" + snakeModel.food.x.toString() + "0" + snakeModel.food.y.toString())
            snakeHeadElement.classList.add('snake')
            foodElement.classList.add('food')
            let tmpVar = snakeModel.snakeHead;
            while (tmpVar.next != undefined) {
                tmpVar = tmpVar.next;
                let newSnakeBodyElement = document.getElementById("0" + tmpVar.x.toString() + "0" + tmpVar.y.toString())
                newSnakeBodyElement.classList.add('snake');
                
            }
        }

        function board() {
            let html = ""
            for (let i = 0; i < snakeModel.boardSize; i++) {
                html += "<div class='container'>";
                for (let j = 0; j < snakeModel.boardSize; j++) {
                    html += /*HTMl*/ `<div id='0${i}0${j}' class='cell'></div>`
                }
                html += "</div>"
            }

            return html;
        }
        //Controller
        initModel();
        showView();
        setInterval(moveSnake, 150);
        function initModel() {
            snakeModel.snakeHead = getRandomCell();
            snakeModel.food = getRandomCell();
        }

        function getRandomCell() {
            let x = Math.floor(Math.random() * snakeModel.boardSize)
            let y = Math.floor(Math.random() * snakeModel.boardSize)

            let snakeHead = { x: x, y: y };
            return snakeHead;
        }

        function moveSnake() {
            let newSnakeBody

            newSnakeBody = { x: snakeModel.snakeHead.x, y: snakeModel.snakeHead.y };
            newSnakeBody.next = snakeModel.snakeHead;
            snakeModel.snakeHead = newSnakeBody;


            if (snakeModel.direction == "up")
                snakeModel.snakeHead.x--
            else if (snakeModel.direction == "down")
                snakeModel.snakeHead.x++
            else if (snakeModel.direction == "left")
                snakeModel.snakeHead.y--
            else if (snakeModel.direction == "right")
                snakeModel.snakeHead.y++

            if ((snakeModel.snakeHead.x == snakeModel.food.x) && (snakeModel.snakeHead.y == snakeModel.food.y)) {
                snakeModel.food = getRandomCell();
            }
            else {
                newSnakeBody = snakeModel.snakeHead;
                while (newSnakeBody.next.next != undefined) {
                    newSnakeBody = newSnakeBody.next;                   
                }
                newSnakeBody.next = undefined;
            }


            showView();
        }

        function getKeyPress(e) {
            console.log(e.key)
            if (e.key == "ArrowUp")
                snakeModel.direction = "up"
            else if (e.key == "ArrowRight")
                snakeModel.direction = "right"
            else if (e.key == "ArrowDown")
                snakeModel.direction = "down"
            else if (e.key == "ArrowLeft")
                snakeModel.direction = "left"
        }


    </script>
</body>

</html>